# CIFAR-10 Classifier

一个结构规范、代码简洁的 CIFAR-10 图像分类项目，提供可复用的训练脚手架、评估脚本与可视化 Demo（Gradio）。同时示例包含 ResNet18 微调与一个简单 CNN，并支持可切换到 CIFAR-100。

## 功能特性
- 简单 CNN 与 ResNet18 两套模型，支持预训练微调
- 统一的 YAML 配置驱动（模型/数据/训练）
- 训练、验证、测试全流程与最优/最后权重保存
- 评估脚本与 Gradio 可视化 Demo

## 环境依赖
- Python 3.8+
- PyTorch, torchvision
- numpy, pyyaml, gradio

安装（示例）：
```bash
pip install torch torchvision numpy pyyaml gradio
```

## 数据准备
本项目默认不自动下载数据（download=False）。请将数据放到配置文件中的 dataset.data_root 目录，例如：
```
data/
  └─ cifar-10-python/  # torchvision 的 CIFAR-10 Python 版本目录
```
你也可以修改 configs 中的 data_root 为你的本地路径。

## 快速开始
- 训练 SimpleCNN：
```bash
python -m src.train.train --cfg configs/simplecnn10_cifar10.yaml
```
- 训练 ResNet18：
```bash
python -m src.train.train --cfg configs/resnet18_cifar10.yaml
```
- 评估（使用配置中 output_dir/best.pt，或用 --ckpt 指定）：
```bash
python -m src.test.test_dataset --cfg configs/resnet18_cifar10.yaml
```
- 启动 Gradio Demo：
```bash
python -m src.test.test_gradio --cfg configs/resnet18_cifar10.yaml
```

也可使用 Makefile 快捷命令：
```bash
make train-simplecnn
make train-resnet18
make test-dataset-simplecnn
make test-gradio-resnet18
```

## 配置说明（YAML）
以 configs/resnet18_cifar10.yaml 为例：
```yaml
model:
  name: resnet18        # simple_cnn | resnet18
  num_classes: 10
  pretrained: True      # 仅对 resnet18 生效

seed: 42

dataset:
  name: cifar10         # cifar10 | cifar100
  data_root: data/cifar-10-python
  val_ratio: 0.1
  num_workers: 4
  pin_memory: true
  shuffle: True

train:
  batch_size: 2040
  epochs: 50
  device: cuda          # cuda | cpu（程序会自动回退到可用设备）
  criterion: cross_entropy
  optimizer: adam
  lr: 0.001
  output_dir: outputs/checkpoints/resnet18_cifar10
```
训练过程中会在 output_dir 下保存 best.pt（验证集最优）与 last.pt（最近一次）。

## 目录结构
```
.
├── configs/
│   ├── simplecnn10_cifar10.yaml
│   └── resnet18_cifar10.yaml
├── src/
│   ├── datasets/      # 数据加载与增强（含 CIFAR-10/100）
│   ├── models/        # SimpleCNN、ResNet18（适配 32x32）
│   ├── train/         # 训练入口与过程
│   ├── test/          # 评估与 Gradio Demo
│   └── utils/         # 实用工具（随机种子等）
├── data/              # 本地数据（自行准备）
└── outputs/           # 训练产物（权重、日志等）
```

## 常见问题
- 找不到数据：确认 dataset.data_root 指向含 CIFAR-10 Python 版本文件的目录；本项目不自动下载。
- 设备选择：train.device 可设为 cuda 或 cpu，脚本会根据可用性自动选择。
- CIFAR-100：将 dataset.name 改为 cifar100，并参考 configs/simplecnn10_cifar100.yaml（如需）。

## 许可与致谢
本项目仅用于学习与演示，模型结构与数据集来自 PyTorch/torchvision 官方实现与数据。